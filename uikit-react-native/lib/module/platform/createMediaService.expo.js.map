{"version":3,"names":["React","getDownscaleSize","SBUUtils","createExpoMediaService","_ref","avModule","thumbnailModule","imageManipulator","fsModule","VideoComponent","_ref2","source","resizeMode","onLoad","props","createElement","Video","_extends","useNativeControls","getVideoThumbnail","_ref3","url","quality","timeMills","uri","getThumbnailAsync","time","path","compressImage","_ref4","maxWidth","maxHeight","compressionRate","originSize","getImageSize","resizingSize","width","height","compressedURI","manipulateAsync","resize","compress","Math","min","max","size","getInfoAsync"],"sources":["createMediaService.expo.tsx"],"sourcesContent":["import type * as ExpoAV from 'expo-av';\nimport type * as ExpoFS from 'expo-file-system';\nimport type * as ExpoImageManipulator from 'expo-image-manipulator';\nimport type * as ExpoVideoThumbnail from 'expo-video-thumbnails';\nimport React from 'react';\n\nimport { getDownscaleSize } from '@sendbird/uikit-utils';\n\nimport SBUUtils from '../libs/SBUUtils';\nimport type { MediaServiceInterface } from './types';\n\ntype Modules = {\n  avModule: typeof ExpoAV;\n  thumbnailModule: typeof ExpoVideoThumbnail;\n  imageManipulator: typeof ExpoImageManipulator;\n  fsModule: typeof ExpoFS;\n};\n\nconst createExpoMediaService = ({\n  avModule,\n  thumbnailModule,\n  imageManipulator,\n  fsModule,\n}: Modules): MediaServiceInterface => {\n  return {\n    VideoComponent({ source, resizeMode, onLoad, ...props }) {\n      // FIXME: type error https://github.com/expo/expo/issues/17101\n      // @ts-ignore\n      return <avModule.Video {...props} source={source} resizeMode={resizeMode} onLoad={onLoad} useNativeControls />;\n    },\n    async getVideoThumbnail({ url, quality, timeMills }) {\n      try {\n        const { uri } = await thumbnailModule.getThumbnailAsync(url, { quality, time: timeMills });\n        return { path: uri };\n      } catch {\n        return null;\n      }\n    },\n    async compressImage({ maxWidth, maxHeight, compressionRate = 1, uri }) {\n      const originSize = await SBUUtils.getImageSize(uri);\n      const resizingSize = getDownscaleSize(originSize, { width: maxWidth, height: maxHeight });\n\n      const { uri: compressedURI } = await imageManipulator.manipulateAsync(uri, [{ resize: resizingSize }], {\n        compress: Math.min(Math.max(0, compressionRate), 1),\n      });\n      const { size = 0 } = await fsModule.getInfoAsync(uri);\n\n      return { uri: compressedURI, size };\n    },\n  };\n};\n\nexport default createExpoMediaService;\n"],"mappings":";AAIA,OAAOA,KAAK,MAAM,OAAO;AAEzB,SAASC,gBAAgB,QAAQ,uBAAuB;AAExD,OAAOC,QAAQ,MAAM,kBAAkB;AAUvC,MAAMC,sBAAsB,GAAGC,IAAA,IAKO;EAAA,IALN;IAC9BC,QAAQ;IACRC,eAAe;IACfC,gBAAgB;IAChBC;EACO,CAAC,GAAAJ,IAAA;EACR,OAAO;IACLK,cAAcA,CAAAC,KAAA,EAA2C;MAAA,IAA1C;QAAEC,MAAM;QAAEC,UAAU;QAAEC,MAAM;QAAE,GAAGC;MAAM,CAAC,GAAAJ,KAAA;MACrD;MACA;MACA,oBAAOV,KAAA,CAAAe,aAAA,CAACV,QAAQ,CAACW,KAAK,EAAAC,QAAA,KAAKH,KAAK;QAAEH,MAAM,EAAEA,MAAO;QAACC,UAAU,EAAEA,UAAW;QAACC,MAAM,EAAEA,MAAO;QAACK,iBAAiB;MAAA,GAAG;IAChH,CAAC;IACD,MAAMC,iBAAiBA,CAAAC,KAAA,EAA8B;MAAA,IAA7B;QAAEC,GAAG;QAAEC,OAAO;QAAEC;MAAU,CAAC,GAAAH,KAAA;MACjD,IAAI;QACF,MAAM;UAAEI;QAAI,CAAC,GAAG,MAAMlB,eAAe,CAACmB,iBAAiB,CAACJ,GAAG,EAAE;UAAEC,OAAO;UAAEI,IAAI,EAAEH;QAAU,CAAC,CAAC;QAC1F,OAAO;UAAEI,IAAI,EAAEH;QAAI,CAAC;MACtB,CAAC,CAAC,MAAM;QACN,OAAO,IAAI;MACb;IACF,CAAC;IACD,MAAMI,aAAaA,CAAAC,KAAA,EAAoD;MAAA,IAAnD;QAAEC,QAAQ;QAAEC,SAAS;QAAEC,eAAe,GAAG,CAAC;QAAER;MAAI,CAAC,GAAAK,KAAA;MACnE,MAAMI,UAAU,GAAG,MAAM/B,QAAQ,CAACgC,YAAY,CAACV,GAAG,CAAC;MACnD,MAAMW,YAAY,GAAGlC,gBAAgB,CAACgC,UAAU,EAAE;QAAEG,KAAK,EAAEN,QAAQ;QAAEO,MAAM,EAAEN;MAAU,CAAC,CAAC;MAEzF,MAAM;QAAEP,GAAG,EAAEc;MAAc,CAAC,GAAG,MAAM/B,gBAAgB,CAACgC,eAAe,CAACf,GAAG,EAAE,CAAC;QAAEgB,MAAM,EAAEL;MAAa,CAAC,CAAC,EAAE;QACrGM,QAAQ,EAAEC,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAAC,CAAC,EAAEZ,eAAe,CAAC,EAAE,CAAC;MACpD,CAAC,CAAC;MACF,MAAM;QAAEa,IAAI,GAAG;MAAE,CAAC,GAAG,MAAMrC,QAAQ,CAACsC,YAAY,CAACtB,GAAG,CAAC;MAErD,OAAO;QAAEA,GAAG,EAAEc,aAAa;QAAEO;MAAK,CAAC;IACrC;EACF,CAAC;AACH,CAAC;AAED,eAAe1C,sBAAsB"}