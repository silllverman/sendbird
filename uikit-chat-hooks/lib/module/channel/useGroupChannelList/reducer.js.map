{"version":3,"names":["useReducer","getGroupChannels","defaultReducer","_ref","action","draft","compareByOrder","createCompareByOrder","order","type","refreshing","value","status","loading","channels","forEach","freshChannel","idx","groupChannels","findIndex","staleChannel","url","sort","channelUrls","c","splice","clearBeforeAction","useGroupChannelListReducer","dispatch","updateChannels","deleteChannels","setChannels","updateLoading","updateRefreshing","updateOrder","undefined","channel1","channel2","lastMessage","createdAt","name","localeCompare"],"sources":["reducer.ts"],"sourcesContent":["import { useReducer } from 'react';\n\nimport type { SendbirdChannel } from '@sendbird/uikit-utils';\nimport { SendbirdGroupChannel, getGroupChannels } from '@sendbird/uikit-utils';\n\ntype Order = 'latest_last_message' | 'chronological' | 'channel_name_alphabetical' | 'metadata_value_alphabetical';\n\ntype Action =\n  | {\n      type: 'update_loading' | 'update_refreshing';\n      value: { status: boolean };\n    }\n  | {\n      type: 'update_channels';\n      value: { channels: SendbirdChannel[] };\n    }\n  | {\n      type: 'delete_channels';\n      value: { channelUrls: string[] };\n    }\n  | {\n      type: 'set_channels';\n      value: { channels: SendbirdChannel[]; clearBeforeAction: boolean };\n    }\n  | {\n      type: 'update_order';\n      value: { order?: Order };\n    };\n\ntype State = {\n  loading: boolean;\n  refreshing: boolean;\n  groupChannels: SendbirdGroupChannel[];\n  order?: Order;\n};\n\nconst defaultReducer = ({ ...draft }: State, action: Action) => {\n  const compareByOrder = createCompareByOrder(draft.order);\n\n  switch (action.type) {\n    case 'update_refreshing': {\n      draft.refreshing = action.value.status;\n      break;\n    }\n    case 'update_loading': {\n      draft.loading = action.value.status;\n      break;\n    }\n    case 'update_channels': {\n      getGroupChannels(action.value.channels).forEach((freshChannel) => {\n        const idx = draft.groupChannels.findIndex((staleChannel) => staleChannel.url === freshChannel.url);\n        if (idx > -1) draft.groupChannels[idx] = freshChannel;\n      });\n\n      compareByOrder && (draft.groupChannels = draft.groupChannels.sort(compareByOrder));\n      break;\n    }\n    case 'delete_channels': {\n      action.value.channelUrls.forEach((url) => {\n        const idx = draft.groupChannels.findIndex((c) => c.url === url);\n        if (idx > -1) draft.groupChannels.splice(idx, 1);\n      });\n\n      compareByOrder && (draft.groupChannels = draft.groupChannels.sort(compareByOrder));\n      break;\n    }\n    case 'set_channels': {\n      if (action.value.clearBeforeAction) {\n        draft.groupChannels = getGroupChannels(action.value.channels);\n      } else {\n        draft.groupChannels = [...draft.groupChannels, ...getGroupChannels(action.value.channels)];\n      }\n\n      compareByOrder && (draft.groupChannels = draft.groupChannels.sort(compareByOrder));\n      break;\n    }\n    case 'update_order': {\n      draft.order = action.value.order;\n      const compareByOrder = createCompareByOrder(draft.order);\n      compareByOrder && (draft.groupChannels = draft.groupChannels.sort(compareByOrder));\n      break;\n    }\n  }\n  return draft;\n};\n\nexport const useGroupChannelListReducer = (order?: Order) => {\n  const [{ loading, refreshing, groupChannels }, dispatch] = useReducer(defaultReducer, {\n    loading: true,\n    refreshing: false,\n    groupChannels: [],\n    order,\n  });\n\n  const updateChannels = (channels: SendbirdChannel[]) => {\n    dispatch({ type: 'update_channels', value: { channels } });\n  };\n  const deleteChannels = (channelUrls: string[]) => {\n    dispatch({ type: 'delete_channels', value: { channelUrls } });\n  };\n  const setChannels = (channels: SendbirdChannel[], clearBeforeAction: boolean) => {\n    dispatch({ type: 'set_channels', value: { channels, clearBeforeAction } });\n  };\n  const updateLoading = (status: boolean) => {\n    dispatch({ type: 'update_loading', value: { status } });\n  };\n  const updateRefreshing = (status: boolean) => {\n    dispatch({ type: 'update_refreshing', value: { status } });\n  };\n  const updateOrder = (order?: Order) => {\n    dispatch({ type: 'update_order', value: { order } });\n  };\n\n  return {\n    updateLoading,\n    updateRefreshing,\n    updateChannels,\n    deleteChannels,\n    setChannels,\n\n    updateOrder,\n\n    loading,\n    refreshing,\n    groupChannels,\n  };\n};\n\nconst createCompareByOrder = (order?: Order) => {\n  if (!order) return undefined;\n\n  return (channel1: SendbirdGroupChannel, channel2: SendbirdGroupChannel): number => {\n    switch (order) {\n      case 'latest_last_message': {\n        if (channel1.lastMessage && channel2.lastMessage) {\n          return channel2.lastMessage.createdAt - channel1.lastMessage.createdAt;\n        } else if (channel1.lastMessage) {\n          return -1;\n        } else if (channel2.lastMessage) {\n          return 1;\n        } else {\n          return channel2.createdAt - channel1.createdAt;\n        }\n      }\n\n      case 'chronological': {\n        return channel2.createdAt - channel1.createdAt;\n      }\n\n      case 'channel_name_alphabetical': {\n        return channel1.name.localeCompare(channel2.name);\n      }\n      default: {\n        return 0;\n      }\n    }\n  };\n};\n"],"mappings":"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"}